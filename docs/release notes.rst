.. _`поиск документооборотов`: https://developer.testkontur.ru/doc/extern/method?type=get&path=%2Fv1%2F%7BaccountId%7D%2Fdocflows
.. _`POST Recognize`: https://developer.testkontur.ru/doc/extern/method?type=post&path=%2Fv1%2F%7BaccountId%7D%2Fdocflows%2F%7BdocflowId%7D%2Fdocuments%2F%7BdocumentId%7D%2Frecognize
.. _`Send`: https://developer.testkontur.ru/doc/extern/method?type=post&path=%2Fv1%2F%7BaccountId%7D%2Fdrafts%2F%7BdraftId%7D%2Fsend
.. _`сервис контентов`: https://developer.testkontur.ru/doc/extern/method?type=post&path=%2Fv1%2F%7BaccountId%7D%2Fcontents
.. _`POST SignPfrReplyDocument`: https://developer.testkontur.ru/doc/extern/method?type=post&path=%2Fv1%2F%7BaccountId%7D%2Fdocflows%2F%7BdocflowId%7D%2Fdocuments%2F%7BdocumentId%7D%2Fpfr-replies%2F%7BreplyId%7D%2Fcloud-sign
.. _`GET DocflowPfrReplyDocumentTask`: https://developer.testkontur.ru/doc/extern/method?type=get&path=%2Fv1%2F%7BaccountId%7D%2Fdocflows%2F%7BdocflowId%7D%2Fdocuments%2F%7BdocumentId%7D%2Fpfr-replies%2F%7BreplyId%7D%2Ftasks%2F%7BapiTaskId%7D
.. _`POST SignConfirmPfrReplyDocument`: https://developer.testkontur.ru/doc/extern/method?type=post&path=%2Fv1%2F%7BaccountId%7D%2Fdocflows%2F%7BdocflowId%7D%2Fdocuments%2F%7BdocumentId%7D%2Fpfr-replies%2F%7BreplyId%7D%2Fcloud-sign-confirm

История изменений API
=====================

Июнь 2020
---------

* Ответные документы (Reply documents) для ПФР теперь можно подписывать DSS сертификатом. Для этого доступны новые методы: `POST SignPfrReplyDocument`_, `GET DocflowPfrReplyDocumentTask`_, `POST SignConfirmPfrReplyDocument`_. Подробнее о :doc:`подписании документов в документообороте</dc/подпись в до>`.
* В методах API добавлена возможность формирования подписи xmlDsig для подписания :doc:`отчета СЗВ-ТД и заявления на подключение к ЭДОК в ПФР</knowledge base/szvtd>`. Подробное описание в документации: :doc:`Подпись XMLDsig для отчетов в ПФР</manuals/xmldsig>`.

Май 2020
--------

* Добавили в :doc:`методы формирования файлов</drafts/DraftDocumentBuildController>` в черновике возможность генерации заявления на подключение к ЭДОК. Достаточно передать валидный JSON контракт, метод сгенерирует контент файла и положит его в документ черновика.
* О штампах в печатных формах:

    * Внесли правки в печати штампов на отчетах. 
    * Добавили в штампы помимо названия инспекции ее код.
    * Добавили штампы в печатные формы отчета 2-НДФЛ.

* В печатных формах добавили указание общего количества страниц.
* В документации добавили новый раздел :doc:`Начало работы с API</howto/index>`.

Апрель 2020
-----------

* Доработали `поиск документооборотов`_: теперь можно запрашивать сразу несколько типов в параметре type. Например, type=fns534-report&type=pfr-report.
* Новый вид отчетности в ПФР: отправка отчета СЗВ-ТД и готового заявления на подключение к ЭДОК.
* Добавили в description документооборота ИНН-КПП реорганизованных и ликвидированных организаций, которые лежат внутри отчетов по таким организациям.
* В рамках :doc:`документооборота регистрации бизнеса</knowledge base/businessReg>` реализовали регистрацию ЮЛ, отправку документов на ликвидацию ИП.

Март 2020
---------

* Добавили возможность асинхронной печати документов, теперь можно ставить задачи на печать (Tasks).
* Исправили появление дублей в документообороте Росстата.
* Ускорили процесс отправки черновиков.
* Поддержали дешифрование DSS сертификатом квитанций от ФСС.
* Добавили ссылки в документообороте 4-ФСС, которые ведут в веб интерфейс Экстерна.
* Добавили проверку сертификата подписи при отправке ответных документов ФНС: ИНН в сертификате подписи должен быть равен ИНН в поле Sender. 

Февраль 2020
------------

* Изменили `поиск документооборотов`_:

    * теперь в общий список не будут попадать документообороты регистрации бизнеса. Чтобы получить документообороты по данному типу нужно передать параметр ``type = business-registration``;
    * добавили новый тип документооборота с ФСС — Подтверждение основного вида экономической деятельности (ПОВЭД). Данный тип документооборота можно только получить. Отправить электронную форму ПОВЭД можно только в Экстерне. 

* Научились распознавать срок ответа на требование из PDF файла требования ФНС. Метод распознавания требования `POST Recognize`_.
* Исправили текст сообщений об ошибках отправки черновика (`Send`_) для случаев, когда указан неверный тип контента или некорректный ip-адрес.
* Исправили ошибку генерации ответного документа (reply document), у которого нет печатной формы.
* В документации добавили статью по работе с методами :ref:`ленты событий <rst-markup-events>`, также описаны :doc:`/specification/статусы ленты событий`.
* Добавили новые методы по работе с контентом, см. раздел в swagger `сервис контентов`_:
    
    * Реализована работа с большими файлами документов документооборотов: методы позволяют скачивать контент любого размера. 
    * В модели документооборотов, созданных от 02.02.2020, добавлены идентификаторы контентов документов.
    * В методах по работе с контентами файлов можно передавать только идентификатор контента, например, для печати документа.

Январь 2020
-----------

**Обновления в API Контур.Экстерна:**

* Добавили уведомления в ленту событий по документооборотам ФСС и ПФР.
* Добавили контентам документов описание состояния: сжат, зашифрован, расшифрован и т.д. Ранее описание состояния было только у документа и могло быть некорректным.
* При работе с сертификатами DSS теперь можно сохранять расшифрованный контент в документооборот. 
* Исправили ошибку при создании черновика: для ИП не обязательно заполнение Payer.Organization.

**Обновления в Extern Test Tools:**

* В методах генерации требований и писем добавили поле ifnsCode, что позволит тестировать получение требований от разных ИФНС. 

______

Ранее мы не вели практику написания изменений в API, поэтому обновлений за 2018-2019 год нет. 