.. _`Справочная информация об отчетности по форме СЗВ-ТД`: https://support.kontur.ru/pages/viewpage.action?pageId=43058621
.. _`Описание стандарта подписи`: https://www.w3.org/TR/2013/REC-xmldsig-core1-20130411/ 
.. _`POST Draft`: https://developer.testkontur.ru/doc/extern/method?type=post&path=%2Fv1%2F%7BaccountId%7D%2Fdrafts
.. _`POST Upload`: https://developer.testkontur.ru/doc/extern/method?type=post&path=%2Fv1%2F%7BaccountId%7D%2Fcontents
.. _`GET Download`: https://developer.testkontur.ru/doc/extern/method?type=get&path=%2Fv1%2F%7BaccountId%7D%2Fcontents%2F%7Bid%7D
.. _`POST BuildDocumentContent`: https://developer.testkontur.ru/doc/extern/method?type=post&path=%2Fv1%2F%7BaccountId%7D%2Fdrafts%2F%7BdraftId%7D%2Fbuild-document
.. _`POST Document`: https://developer.testkontur.ru/doc/extern/method?type=post&path=%2Fv1%2F%7BaccountId%7D%2Fdrafts%2F%7BdraftId%7D%2Fdocuments
.. _`PUT Document`: https://developer.testkontur.ru/doc/extern/method?type=put&path=%2Fv1%2F%7BaccountId%7D%2Fdrafts%2F%7BdraftId%7D%2Fdocuments%2F%7BdocumentId%7D
.. _`POST Check`: https://developer.testkontur.ru/doc/extern/method?type=post&path=%2Fv1%2F%7BaccountId%7D%2Fdrafts%2F%7BdraftId%7D%2Fcheck
.. _`POST Prepare`: https://developer.testkontur.ru/doc/extern/method?type=post&path=%2Fv1%2F%7BaccountId%7D%2Fdrafts%2F%7BdraftId%7D%2Fprepare
.. _`POST Send`: https://developer.testkontur.ru/doc/extern/method?type=post&path=%2Fv1%2F%7BaccountId%7D%2Fdrafts%2F%7BdraftId%7D%2Fsend
.. _`GET DraftDocument`: https://developer.testkontur.ru/doc/extern/method?type=get&path=%2Fv1%2F%7BaccountId%7D%2Fdrafts%2F%7BdraftId%7D
.. _`PUT DocumentSignature`: https://developer.testkontur.ru/doc/extern/method?type=put&path=%2Fv1%2F%7BaccountId%7D%2Fdrafts%2F%7BdraftId%7D%2Fdocuments%2F%7BdocumentId%7D%2Fsignature

Отчетность по форме СЗВ-ТД
==========================

* `Что нужно сделать, чтобы начать отправлять сведения в ПФР?`_
* `Порядок действий для отправки заявления на подключение к ЭДОК`_
* `Порядок действий для отправки отчета по форме СЗВ-ТД`_
* `Помощь с подписанием документов подписью xmlDsig`_


Что нужно сделать, чтобы начать отправлять сведения в ПФР?
----------------------------------------------------------

`Справочная информация об отчетности по форме СЗВ-ТД`_.

Чтобы работодатель мог отправлять в электронном виде сведения в ПФР, ему нужно направить в электронном виде заявление на подключение к системе электронного документооборота ПФР. Данное заявление должно содержать:

* регистрационный номер страхователя в ПФР;
* наименование страхователя (юридического лица);
* ИНН;
* КПП страхователя (юридического лица);
* ФИО (при наличии) страхователя (физического лица);
* реквизиты оператора, через которого планируется передача сведений.

После отправки заявления на подключение к ЭДО ПФР, у работодателя появится возможность сдавать сведения по форме СЗВ-ТД через оператора связи привычным для него способом. Для отключения от ЭДО ПФР необходимо подать «Заявление на отключение от ЭДО ПФР». 

Особенности подписи
~~~~~~~~~~~~~~~~~~~

Заявление и отчет должны быть подписаны подписью в формате xmlDsig. Для этого соответствующий блок Signature выносится по w3c в корень. Такая подпись является подписью по правилам СМЭВ 3. `Описание стандарта подписи`_ (см. Enveloped or enveloping signatures).

Если вы испытываете трудности в добавлении подписи в документ черновика на своей стороне, в методах API реализована функция помощи в подписании. Читайте `Помощь с подписанием документов подписью xmlDsig`_.

.. note:: Если у вас DSS сертификат, то вам не нужно использовать вспомогательные методы. Просто подпишите черновик, подробнее в документации :doc:`подписание черновика</drafts/подпись в черновике>`

Порядок действий для отправки заявления на подключение к ЭДОК
-------------------------------------------------------------

Заявление на подключение страхователя к ЭДО ПФР можно передать через API Конутр.Экстерна, **тип документооборота urn:docflow:pfr-ancillary**. Статусы и порядок документооборота описаны в :ref:`спецификации<rst-markup-ancillary-status>`.

Если у вас уже есть файл заявления на подключение к ЭДОК с прикрепленной подписью xmlDsig: 

#. Создать черновик. `POST Draft`_.
#. Загрузить в :doc:`сервис контентов</knowledge base/content>` подписанный файл заявления с прикрепленной подписью xmlDsig. `POST Upload`_.
#. Создать документ в черновике, в теле запроса передать идентификатор контента content-id. `POST Document`_.
#. Проверить, подготовить, отправить черновик. `POST Check`_, `POST Prepare`_, `POST Send`_.
#. ПФР в течение двух рабочих дней направит «Уведомление о результате рассмотрения», успешно принятым считается уведомление с отметкой об удовлетворении заявления. Документооборот завершен.

Если у вас нет файла заявления на подключение, его можно сгенерировать при помощи :doc:`методов формирования файлов</drafts/методы для формирования ФУФов>` в черновике. Сценарий работы **с черновиком** в таком случае будет следующий:

#. Создать черновик. `POST Draft`_.
#. Создать документ в черновкие по json контракту. `POST BuildDocumentContent`_.
#. По content-id скачать сгенерированный файл заявления из сервиса контентов. `GET Download`_.
#. Добавить в файл подпись в формате xmlDsig. 
#. Подписанный файл нужно загрузить в сервис контентов. `POST Upload`_
#. Заменить контент документа на полученный идентификатор сервиса контентов `PUT Document`_. 
#. Проверить, подготовить, отправить черновик. `POST Check`_, `POST Prepare`_, `POST Send`_.

Порядок действий для отправки отчета по форме СЗВ-ТД
----------------------------------------------------

Отчет по форме СЗВ-ТД нужно отправлять отдельным **документооборотом типа urn:docflow:pfr-report**. Статусы и порядок документооборота описаны в :ref:`спецификации<rst-markup-szvtd-status>`.

#. Создать черновик. `POST Draft`_.
#. Загрузить в :doc:`сервис контентов</knowledge base/content>` подписанный файл отчета с прикрепленной подписью xmlDsig. `POST Upload`_.
#. Создать документ в черновике, в теле запроса передать идентификатор контента content-id. `POST Document`_.
#. Проверить, подготовить, отправить черновик. `POST Check`_, `POST Prepare`_, `POST Send`_.
#. ПФР в течение одного рабочего дня направит "Уведомление о доставке".
#. ПФР в течение трех рабочих дней с момента отправки "Уведомления о доставке":

    #. в случае выявления ошибок сформирует и пришлет "Уведомление об отказе в приеме пакета". Документооборот завершен.
    #. по результатам проверок сформирует "Протокол проверок" или "Уведомление об устранении ошибок и (или) несоответствий между представленными страхователем сведениями и сведениями, имеющимися у ПФР".

#. Оператор ЭДО сформирует "Уведомление о доставке" на "Уведомление об устранении ошибок...", которое будет отправлено в ПФР, а также появится в документообороте. Документооборот завершен.

Помощь с подписанием документов подписью xmlDsig
------------------------------------------------

Если у вас есть затруднения в добавлении подписи в файл, вы можете воспользоваться помощью методов API:

#. Загрузить в черновик XML-документ (Отчет или Заявление на подключение). Либо сформировать заявление с помощью documentBuilder.
#. Проверить черновик `POST Check`_.
#. Если в загруженном документе не было XMLDsig, то на шаге Check в документ будет добавлено поле dataToSignContentId.
#. После Check необходимо получить документ `GET DraftDocument`_.
#. Через сервис контентов по dataToSignContentId получить данные для подписи `GET Download`_.
#. Подписать эти данные "сырой" (raw) подписью.
#. Загрузить в черновик подпись `PUT DocumentSignature`_.
#. Вызвать для черновика шаг `POST Prepare`_. На этом шаге подпись XMLDsig будет добавлена в XML-документ.