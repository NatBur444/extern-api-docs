.. _Docflows: http://extern-api.testkontur.ru/swagger/ui/index#/Docflows
.. _`POST SignReplyDocument`: http://extern-api.testkontur.ru/swagger/ui/index#/Docflows/DocflowReplyDocument_SignReplyDocumentAsync
.. _`POST SignConfirmReplyDocument`: http://extern-api.testkontur.ru/swagger/ui/index#/Docflows/DocflowReplyDocument_SignConfirmReplyDocumentAsync
.. _`POST DecryptDocument`: http://extern-api.testkontur.ru/swagger/ui/index#/Docflows/Docflows_DecryptDocumentAsync
.. _`POST DecryptDocumentConfirmation`: http://extern-api.testkontur.ru/swagger/ui/index#/Docflows/Docflows_DecryptDocumentConfirmationAsync

Методы для работы в документооборотах
=====================================

.. important:: Методы данного раздела позволяют работать только с Контур.сертификатами электронной подписи, выпущенными Удостоверяющим центром АО "ПФ "СКБ Контур" (https://ca.kontur.ru).

В случае использования Контур.Сертификата в части работы с документооборотами появляется возможность проводить **подписание** и **расшифровку** документов, возникающих в ходе документооборота, на серверах Контур.Экстерна. То есть нет необходимости установки криптопровайдеров и ключей сертификатов электронной подписи на рабочие места пользователей.

.. image:: /_static/cloud.jpg

* в запросе передаются документы, которые необходимо подписать или расшифровать,
* в ответ возвращается идентификатор запроса, отправляется смс-сообщением с кодом,
* полученный код передается в запросе на подтверждение операции,
* расшифрованный контент документа сохраняется в документообороте / добавляется подпись под ответный документ

Подробная спецификация методов показана в сваггере в разделе Docflows_.

Список доступных методов:

* `Подпись ответного документа`_
* `Подтверждение подписи ответного документа`_
* `Дешифрование документа`_
* `Подтверждение дешифрования документа`_

.. _rst-markup-post-sign-reply-doc:

Подпись ответного документа
---------------------------
Метод: `POST SignReplyDocument`_

Позволяет подписать сгенерированный ответный документ (:ref:`Генерация ответного документа <rst-markup-post-reply-doc>`). 

.. note:: Для подписи извещений о получении на документы от ФНС или Росстата можно указать параметр ``forceConfirmation=false`` или не указывать его вовсе, тогда подписание документа произойдет сразу, без необходимости подтверждения кодом из смс-сообщения (смс-сообщение также не отправляется). При ``forceConfirmation=true`` и для подписания документов, отличных от извещений о получении, подтверждение кодом обязательно. 

Подтверждение подписи ответного документа
-----------------------------------------
Метод: `POST SignConfirmReplyDocument`_

После ввода кода из смс-сообщения, произойдет подписание документа. Подпись добавится под ответный документ.

.. _rst-markup-post-decrypt-doc:

Дешифрование документа
----------------------
Метод: `POST DecryptDocument`_

С помощью данного метода можно расшифровать любой зашифрованный документ в документообороте. 

Подтверждение дешифрования документа
------------------------------------
Метод: `POST DecryptDocumentConfirmation`_

После ввода кода из смс-сообщения произойдет дешифрование документа. В ответе будет расшифрованный контент.

.. note:: Контент документов в документообороте с контролирующими органами обычно сжимается, для уменьшения объемов передачи по сети. Поэтому после дешифрования в ответе по умолчанию контент будет сжат. Но можно в запросе передать параметр ``unzip=true``, тогда контент после дешифрования автоматически разархивируется.
