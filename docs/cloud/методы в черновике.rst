.. _`POST Drafts_Sign`: http://extern-api.testkontur.ru/swagger/ui/index#!/106310771088108510861074108010821080/Drafts_Sign
.. _`GET GetDraftTask`: http://extern-api.testkontur.ru/swagger/ui/index#!/106310771088108510861074108010821080/Drafts_GetDraftTask
.. _`GET GetSignature`: http://extern-api.testkontur.ru/swagger/ui/index#!/106310771088108510861074108010821080/DraftSignatures_GetSignatureContent

Подписание документов в черновике
=====================

Процесс работы с API для подписания черновика
~~~~~~~~~~~~~~~~~~~~

 1. Подписание черновика `POST Drafts_Sign`_
    В данном методе проверяется тип сертификата пользователя. Если пользователь использует DSS сертификат, то в результате метод вернет модель ``SignInitResult`` с заполненными полями ``TaskId``, ``ConfirmType = myDSS``. Это означает, что сервис перешел в режим ожидания ответа от сервера КриптоПро DSS с результатом операции.

 2. Клиент на своем телефоне в приложении MyDSS вводит ПИН-код от своей облачной ЭП и подтверждает, что он действительно хочет подписать документ;
 3. Проверка статуса задачи подписания документа методом `GET GetDraftTask`_

    * Если состояние ``task-state = failed``, это означает, что на любом этапе подписания возникла ошибка. Описание будет в модели Error.
    * Если состояние ``task-state = running``, это означает, что подпись еще не подтверждена либо еще генерируется.
    * Если состояние ``task-state = succeed``, это означает, что подписание завершено. Файл подписи был успешно сформирован и сохранен в черновике.

 4. Получить подпись `GET GetSignature`_

.. note::
   Подпись будет приложена к документу в черновике, только при вызове метода `GET GetDraftTask`_ с результатом ``task-state = succeed``.
