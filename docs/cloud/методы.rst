.. _`POST Drafts_Sign`: http://extern-api.testkontur.ru/swagger/ui/index#!/10521077109010861076109932107610831103321088107210731086109010993210893210951077108810851086107410801082107210841080/Drafts_Sign
.. _`GET GetDraftTask`: http://extern-api.testkontur.ru/swagger/ui/index#!/10521077109010861076109932107610831103321088107210731086109010993210893210951077108810851086107410801082107210841080/Drafts_GetDraftTask
.. _`GET GetSignatureAsync`: http://extern-api.testkontur.ru/swagger/ui/index#!/10521077109010861076109932107610831103321088107210731086109010993210893210951077108810851086107410801082107210841080/DraftSignatures_GetSignatureAsync


Алгоритм работы с API
=====================


* `Подписание документов в черновике`_
* `Подписание и дешифрование документов в документообороте`_
* `Подписание и дешифрование документов в ответе на требование`_

Подписание документов в черновике
---------------------------------

Процесс работы с API для подписания черновика:

 1. Подписание черновика `POST Drafts_Sign`_
    В данном методе проверяется тип сертификата пользователя. Если пользователь использует DSS сертификат, то в результате метод вернет модель SignInitResult с заполненными полями TaskId, ConfirmType = myDSS. Это означает, что сервис переходит в режим ожидания ответа от сервера КриптоПро DSS с результатом операции.
 2. Клиент на своем телефоне в приложении MyDSS вводит ПИН-код от своей облачной ЭП и подтверждает, что он действительно хочет подписать документ;
 3. Проверка статуса задачи подписания документа методом `GET GetDraftTask`_

    * Если состояние task-state = failed, это означает, что на любом этапе подписания возникла ошибка. Описание будет в модели Error.
    * Если состояние task-state = running, это означает, что подпись еще не подтверждена либо еще генерируется.
    * Если состояние task-state = succeed, это означает, что подписание завершено. Файл подписи был успешно сформирован и сохранен в черновике.

 4. Получить подпись `GET GetSignatureAsync`_

.. note::
   Подпись автоматически не будет приложена к документу в черновике, пока на метод `GET GetDraftTask`_ не будет получено состояние succeed. Мы работаем над автоматизацией процесса.

Подписание и дешифрование документов в документообороте
-------------------------------------------------------

Подписание и дешифрование документов в ответе на требование
-----------------------------------------------------------